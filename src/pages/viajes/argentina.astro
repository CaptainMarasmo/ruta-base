---
import BaseLayout from "../../layouts/BaseLayout.astro";
import itinerarioRaw from "../../data/argentina.js";

type Dia = {
  day: number;
  title: string;
  text?: string;
};

const itinerario: Dia[] = Array.isArray(itinerarioRaw)
  ? [...(itinerarioRaw as Dia[])].sort((a, b) => (a.day ?? 0) - (b.day ?? 0))
  : [];

const daysSet = new Set(itinerario.map((d) => d.day));

const nextExistingDay = (day: number): number | null => {
  for (let i = day + 1; i <= 365; i++) {
    if (daysSet.has(i)) return i;
  }
  return null;
};
---

<BaseLayout title="Argentina | Ruta Base">
  <style>
    .hero{
      position: relative;
      border-radius: 16px;
      overflow: hidden;
      border: 0;
      box-shadow: none;
      background: transparent;
      margin-bottom: 12px;
    }

    .heroImg{
      width: 100%;
      height: 320px;
      object-fit: cover;
      display: block;
      border-radius: 16px;
      border: 1px solid rgba(0,0,0,0.08);
      box-shadow: 0 10px 24px rgba(0,0,0,0.10);
    }

    .pad{
      position: absolute;
      left: 0;
      right: 0;
      bottom: 0;
      padding: 10px;
      display: flex;
      justify-content: flex-start;
      background: linear-gradient(180deg, rgba(0,0,0,0) 0%, rgba(0,0,0,0.35) 100%);
    }
    .caption{
      display: inline-block;
      padding: 4px 8px;
      border-radius: 10px;
      background: rgba(255,255,255,0.35);
      border: 1px solid rgba(0,0,0,0.1);
      margin: 0;
      font-size: 13px;
      font-weight: 600;
      font-style: italic;
      color: #fff;
      text-shadow: 0 1px 2px rgba(0,0,0,0.35);
    }
    .pageTitle{
      margin-top: 0;
      margin-bottom: 10px;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }
    .flag-arg{
      width: 1em;
      height: 1em;
      display: inline-block;
      border-radius: 3px;
      border: 1px solid rgba(0,0,0,0.15);
      background:
        radial-gradient(circle at 50% 50%, #f6c343 0 20%, transparent 21%),
        linear-gradient(135deg, rgba(255,255,255,0.25) 0 30%, rgba(255,255,255,0) 30% 60%, rgba(0,0,0,0.08) 60% 100%),
        linear-gradient(#6cc3ff 0 33%, #ffffff 33% 66%, #6cc3ff 66% 100%);
      box-shadow: 0 1px 3px rgba(0,0,0,0.15);
      vertical-align: -0.1em;
      background-size: 100% 100%, 200% 200%, 100% 100%;
      background-position: center, 20% 30%, center;
    }

    .toc{
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin: 10px 0 16px;
      position: sticky;
      top: 10px;
      z-index: 5;
      backdrop-filter: blur(6px);
      background: rgba(255,255,255,0.7);
      padding: 8px;
      border-radius: 12px;
    }

    .toc a{
      display: inline-block;
      text-decoration: none;
      color: #1a0b2e;
      padding: 6px 10px;
      border-radius: 10px;
      background: rgba(255,255,255,0.65);
      border: 1px solid rgba(0,0,0,0.08);
      font-weight: 700;
      font-size: 13px;
    }

    .toc a:hover{
      background: rgba(155,120,255,0.22);
    }

    /* Secciones plegables */
    details.sec{
      border: 1px solid rgba(0,0,0,0.08);
      border-radius: 14px;
      background: rgba(255,255,255,0.75);
      margin-bottom: 12px;
      overflow: hidden;
    }

    summary.secSummary{
      list-style: none;
      cursor: pointer;
      padding: 14px;
      user-select: none;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      color: #1a0b2e;
      font-weight: 900;
      font-size: 18px;
    }
    /* Solo TOC arriba: ocultar títulos repetidos */
    summary.secSummary{ display: none; }

    summary.secSummary::-webkit-details-marker{ display:none; }

    .secCaret{
      font-size: 18px;
      opacity: 0.7;
      transform: rotate(-90deg);
      transition: transform 0.18s ease;
    }

    details[open] .secCaret{
      transform: rotate(0deg);
    }

    .secBody{
      padding: 0 14px 14px 14px;
      border-top: 1px solid rgba(0,0,0,0.08);
    }
    details.sec{
      border: 0;
      background: transparent;
      margin-bottom: 0;
    }
    details.sec[open]{
      border: 1px solid rgba(0,0,0,0.08);
      border-radius: 14px;
      background: rgba(255,255,255,0.75);
      margin-bottom: 12px;
    }
    /* Mostrar solo títulos; contenido visible solo al abrir */
    details.sec .secBody{ display: none; }
    details.sec[open] .secBody{ display: block; }

    .dots{
      color: #666;
      margin: 10px 0 0 0;
    }

    /* Itinerario */
    .dayList{
      display: grid;
      gap: 10px;
      margin-top: 10px;
    }

    details.day{
      border: 1px solid rgba(0,0,0,0.08);
      border-radius: 12px;
      background: rgba(255,255,255,0.65);
      overflow: hidden;
    }

    summary.daySummary{
      list-style: none;
      cursor: pointer;
      padding: 12px;
      font-weight: 800;
      color: #1a0b2e;
      user-select: none;
    }

    summary.daySummary::-webkit-details-marker{ display:none; }

    .dayBody{
      padding: 0 12px 12px 12px;
      border-top: 1px solid rgba(0,0,0,0.08);
    }

    .dayText{
      margin: 10px 0 0 0;
      color: #222;
      line-height: 1.7;
      white-space: pre-wrap;
    }

    .nextRow{
      margin-top: 12px;
      display: flex;
      justify-content: flex-end;
    }

    .nextBtn{
      display: inline-block;
      text-decoration: none;
      color: #1a0b2e;
      font-weight: 800;
      font-size: 13px;
      padding: 8px 10px;
      border-radius: 10px;
      background: rgba(155,120,255,0.22);
      border: 1px solid rgba(155,120,255,0.45);
    }

    .nextBtn:hover{
      background: rgba(155,120,255,0.30);
    }

    /* MAPA (pequeño + clic para ampliar) */
    .mapWrap{
      display: flex;
      justify-content: center;
      margin-top: 10px;
    }

    .mapBox{
      width: 21%;
      max-width: 240px;
      border-radius: 14px;
      overflow: hidden;
      border: 1px solid rgba(0,0,0,0.08);
      background: rgba(255,255,255,0.65);
    }

    .mapBtn{
      padding: 0;
      border: 0;
      background: transparent;
      cursor: pointer;
      display: block;
      width: 100%;
    }

    .mapImg{
      width: 100%;
      height: auto;
      display: block;
    }

    @media (max-width: 800px){
      .mapBox{ width: 55%; max-width: 340px; }
    }

    /* GALERIA */
    #galeria h3{
      margin: 14px 0 8px 0;
      font-size: 15px;
      color: #1a0b2e;
    }

    .videoGrid{
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
      margin-top: 10px;
      margin-bottom: 18px;
    }

    @media (max-width: 900px){
      .videoGrid{ grid-template-columns: repeat(2, 1fr); }
    }
    @media (max-width: 520px){
      .videoGrid{ grid-template-columns: 1fr; }
    }

    .videoGrid iframe{
      width: 100%;
      aspect-ratio: 16 / 9;
      height: auto;
      border-radius: 10px;
      border: 1px solid rgba(0,0,0,0.10);
      background: rgba(0,0,0,0.04);
    }

    .photoGrid{
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
      gap: 10px;
      margin-top: 10px;
    }

    .photoBtn{
      padding: 0;
      border: 0;
      background: transparent;
      cursor: pointer;
    }

    .photoBtn img{
      width: 100%;
      height: 140px;
      object-fit: cover;
      border-radius: 10px;
      border: 1px solid rgba(0,0,0,0.10);
      display: block;
      transition: transform 0.18s ease;
    }

    .photoBtn:hover img{
      transform: scale(1.03);
    }

    .noScroll{
      overflow: hidden;
    }

    .lightbox{
      position: fixed;
      inset: 0;
      display: none;
      z-index: 9999;
    }

    .lightbox.open{
      display: block;
    }

    .lbBackdrop{
      position: absolute;
      inset: 0;
      background: rgba(0,0,0,0.75);
    }

    .lbPanel{
      position: absolute;
      inset: 0;
      display: grid;
      place-items: center;
      padding: 20px;
    }

    .lbImg{
      max-width: min(92vw, 980px);
      max-height: 82vh;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(255,255,255,0.06);
    }

    .lbClose{
      position: absolute;
      top: 14px;
      right: 14px;
      width: 40px;
      height: 40px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(0,0,0,0.35);
      color: #fff;
      font-size: 26px;
      line-height: 36px;
      cursor: pointer;
    }

    .lbNav{
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      width: 46px;
      height: 56px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(0,0,0,0.35);
      color: #fff;
      font-size: 34px;
      cursor: pointer;
      user-select: none;
    }

    .lbPrev{ left: 14px; }
    .lbNext{ right: 14px; }

    .lbCounter{
      position: absolute;
      bottom: 14px;
      left: 50%;
      transform: translateX(-50%);
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(0,0,0,0.35);
      color: #fff;
      font-weight: 700;
      font-size: 12px;
    }
  </style>

  <div class="titleRow" style="position:relative; width:100%;">
    <div class="titleNav" style="position:absolute; top:-16px; right:-6px; z-index:5; display:flex; align-items:center;">
      <a class="titleArrow" href="/viajes/mexico" aria-label="Siguiente" style="margin-left:-8px;">
        <img src="/giroderecha.png" alt="" style="width:72px; height:72px; object-fit:contain; display:block;" />
      </a>
    </div>
    <h1 class="pageTitle">
      Argentina
      <span class="flag-arg" aria-hidden="true"></span>
    </h1>
  </div>

  <div class="hero">
    <img class="heroImg" src="/perito.png" alt="Perito Moreno" />
    <div class="pad">
      <p class="muted caption">El Perito Moreno es el glaciar más grande y espectacular que he visitado.</p>
    </div>
  </div>

  <div class="toc">
    <a href="#resumen">Resumen</a>
    <a href="#itinerario">Itinerario</a>
    <a href="#imprescindibles">Imprescindibles</a>
    <a href="#costes">Costes</a>
    <a href="#mapa">Mapa</a>
    <a href="#galeria">Galería</a>
  </div>

  <details class="sec" id="resumen">
    <summary class="secSummary">
      <span>Resumen</span><span class="secCaret">▾</span>
    </summary>
    <div class="secBody">
      <p>
        La Ruta Gaucha es un viaje de 25 días por Argentina de norte a sur: arranca en Buenos Aires, sube a la selva de Iguazú, cruza por el norte andino (zona Salta / Purmamarca) y baja a la Patagonia con El Calafate y el glaciar Perito Moreno, para rematar en Ushuaia y Tierra del Fuego, el fin del mundo de verdad. Es una ruta hecha para paisajes y contrastes, no para tachar monumentos.
      </p>
    </div>
  </details>

  <details class="sec" id="itinerario">
    <summary class="secSummary">
      <span>Itinerario</span><span class="secCaret">▾</span>
    </summary>
    <div class="secBody">
      <div class="dayList">
        {itinerario.map((d) => {
          const nextDay = nextExistingDay(d.day);
          const hasText = typeof d.text === "string" && d.text.trim().length > 0;

          return (
            <details class="day" id={`dia-${d.day}`}>
              <summary class="daySummary">Día {d.day} — {d.title}</summary>

              <div class="dayBody">
                {hasText ? <p class="dayText">{d.text}</p> : <p class="dots">…</p>}

                {nextDay && (
                  <div class="nextRow">
                    <a class="nextBtn" href={`#dia-${nextDay}`}>Siguiente día &#10148;</a>
                  </div>
                )}
              </div>
            </details>
          );
        })}
      </div>
    </div>
  </details>

  <details class="sec" id="imprescindibles">
    <summary class="secSummary">
      <span>Imprescindibles</span><span class="secCaret">▾</span>
    </summary>
    <div class="secBody">
      <p class="dots">…</p>
    </div>
  </details>

  <details class="sec" id="costes">
    <summary class="secSummary">
      <span>Costes</span><span class="secCaret">▾</span>
    </summary>
    <div class="secBody">
      <p class="dots">…</p>
    </div>
  </details>

  <details class="sec" id="mapa">
    <summary class="secSummary">
      <span>Mapa</span><span class="secCaret">▾</span>
    </summary>
    <div class="secBody">
      <div class="mapWrap">
        <div class="mapBox">
          <button class="mapBtn" type="button" id="openMap">
            <img class="mapImg" src="/mapa_argentina.png" alt="Mapa de Argentina (ruta)" />
          </button>
        </div>
      </div>

      <p class="dots">Próximamente: mapa interactivo.</p>
    </div>
  </details>

  <details class="sec" id="galeria">
    <summary class="secSummary">
      <span>Galería</span><span class="secCaret">▾</span>
    </summary>
    <div class="secBody">
      <h3>Vídeos</h3>
      <div class="videoGrid">
        <iframe src="https://www.youtube.com/embed/9EjcFCl4EgE" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
        <iframe src="https://www.youtube.com/embed/9gDVJ3nsbjE" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
        <iframe src="https://www.youtube.com/embed/MuWJ-onE2Rw" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
        <iframe src="https://www.youtube.com/embed/xYxQ_LIKkXs" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
        <iframe src="https://www.youtube.com/embed/Hms2foj1WPQ" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
        <iframe src="https://www.youtube.com/embed/7GNv-GpOZA0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
        <iframe src="https://www.youtube.com/embed/l6qduhBFv20" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
        <iframe src="https://www.youtube.com/embed/wEbehw_ghtg" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
        <iframe src="https://www.youtube.com/embed/zLfggdJgItE" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
      </div>

      <h3>Fotos</h3>
      <div class="photoGrid" id="photoGrid">
        <button class="photoBtn" type="button"><img src="/galeria/arg1.jpg" alt="Argentina 1" loading="lazy" /></button>
        <button class="photoBtn" type="button"><img src="/galeria/arg2.jpg" alt="Argentina 2" loading="lazy" /></button>
        <button class="photoBtn" type="button"><img src="/galeria/arg3.jpg" alt="Argentina 3" loading="lazy" /></button>
        <button class="photoBtn" type="button"><img src="/galeria/arg4.jpg" alt="Argentina 4" loading="lazy" /></button>
        <button class="photoBtn" type="button"><img src="/galeria/arg5.jpg" alt="Argentina 5" loading="lazy" /></button>
        <button class="photoBtn" type="button"><img src="/galeria/arg6.jpg" alt="Argentina 6" loading="lazy" /></button>
        <button class="photoBtn" type="button"><img src="/galeria/arg7.jpg" alt="Argentina 7" loading="lazy" /></button>
        <button class="photoBtn" type="button"><img src="/galeria/arg8.png" alt="Argentina 8" loading="lazy" /></button>
        <button class="photoBtn" type="button"><img src="/galeria/arg9.jpg" alt="Argentina 9" loading="lazy" /></button>
        <button class="photoBtn" type="button"><img src="/galeria/arg10.jpg" alt="Argentina 10" loading="lazy" /></button>
        <button class="photoBtn" type="button"><img src="/galeria/arg11.jpg" alt="Argentina 11" loading="lazy" /></button>
        <button class="photoBtn" type="button"><img src="/galeria/arg12.jpg" alt="Argentina 12" loading="lazy" /></button>
        <button class="photoBtn" type="button"><img src="/galeria/arg13.jpg" alt="Argentina 13" loading="lazy" /></button>
        <button class="photoBtn" type="button"><img src="/galeria/arg14.jpg" alt="Argentina 14" loading="lazy" /></button>
        <button class="photoBtn" type="button"><img src="/galeria/arg15.jpg" alt="Argentina 15" loading="lazy" /></button>
        <button class="photoBtn" type="button"><img src="/galeria/arg16.jpg" alt="Argentina 16" loading="lazy" /></button>
        <button class="photoBtn" type="button"><img src="/galeria/arg17.jpg" alt="Argentina 17" loading="lazy" /></button>
        <button class="photoBtn" type="button"><img src="/galeria/arg18.jpg" alt="Argentina 18" loading="lazy" /></button>
      </div>

    </div>
  </details>

  <!-- LIGHTBOX (fotos + mapa) -->
  <div class="lightbox" id="lightbox" aria-hidden="true">
    <div class="lbBackdrop" id="lbBackdrop"></div>

    <div class="lbPanel" role="dialog" aria-modal="true" aria-label="Galería">
      <button class="lbClose" type="button" id="lbClose" aria-label="Cerrar">×</button>

      <button class="lbNav lbPrev" type="button" id="lbPrev" aria-label="Anterior">‹</button>
      <img class="lbImg" id="lbImg" alt="" />
      <button class="lbNav lbNext" type="button" id="lbNext" aria-label="Siguiente">›</button>

      <div class="lbCounter" id="lbCounter">1 / 1</div>
    </div>
  </div>

  <script is:inline>
    (function () {
      // --- SECCIONES: abrir por hash / toc ---
      const getDetailsById = (id) => document.getElementById(id);

      const openSection = (id) => {
        const d = getDetailsById(id);
        if (d && d.tagName.toLowerCase() === "details") d.open = true;
        return d;
      };

      const closeAllSectionsExcept = (keepId) => {
        document.querySelectorAll("details.sec").forEach((d) => {
          if (d.id !== keepId) d.open = false;
        });
      };

      const openFromHash = () => {
        const raw = (location.hash || "").slice(1);
        if (!raw) {
          openSection("resumen");
          closeAllSectionsExcept("resumen");
          return;
        }

        // Si es un día del itinerario
        if (raw.startsWith("dia-")) {
          const it = openSection("itinerario");
          closeAllSectionsExcept("itinerario");

          const dayEl = document.getElementById(raw);
          if (dayEl && dayEl.tagName.toLowerCase() === "details") {
            dayEl.open = true;
            setTimeout(() => dayEl.scrollIntoView({ behavior: "smooth", block: "start" }), 50);
          } else if (it) {
            setTimeout(() => it.scrollIntoView({ behavior: "smooth", block: "start" }), 50);
          }
          return;
        }

        // Si es una sección
        const sec = openSection(raw);
        if (sec) {
          closeAllSectionsExcept(raw);
          setTimeout(() => sec.scrollIntoView({ behavior: "smooth", block: "start" }), 50);
        }
      };

      // Click en la barra: abrir y cerrar el resto
      document.querySelectorAll(".toc a").forEach((a) => {
        a.addEventListener("click", () => {
          const id = (a.getAttribute("href") || "").replace("#", "");
          if (!id) return;
          openSection(id);
          closeAllSectionsExcept(id);
        });
      });

      window.addEventListener("hashchange", openFromHash);
      openFromHash();

      // Itinerario: solo un día abierto a la vez
      const dayDetails = Array.from(document.querySelectorAll("details.day"));
      dayDetails.forEach((d) => {
        d.addEventListener("toggle", () => {
          if (!d.open) return;
          dayDetails.forEach((other) => {
            if (other !== d) other.open = false;
          });
        });
      });

      // --- LIGHTBOX (fotos + mapa) ---
      const grid = document.getElementById("photoGrid");
      const openMapBtn = document.getElementById("openMap");

      const lightbox = document.getElementById("lightbox");
      const backdrop = document.getElementById("lbBackdrop");
      const btnClose = document.getElementById("lbClose");
      const btnPrev = document.getElementById("lbPrev");
      const btnNext = document.getElementById("lbNext");
      const imgEl = document.getElementById("lbImg");
      const counter = document.getElementById("lbCounter");

      if (!lightbox || !imgEl) return;

      const MAP_SRC = "/mapa_argentina.png";

      const imgs = grid ? Array.from(grid.querySelectorAll("img")) : [];
      let index = 0;
      let mode = "photos"; // "photos" | "map"

      const showNav = () => {
        if (btnPrev) btnPrev.style.display = "";
        if (btnNext) btnNext.style.display = "";
      };

      const hideNav = () => {
        if (btnPrev) btnPrev.style.display = "none";
        if (btnNext) btnNext.style.display = "none";
      };

      const setImage = (i) => {
        if (!imgs.length) return;
        index = (i + imgs.length) % imgs.length;
        const src = imgs[index].getAttribute("src") || "";
        const alt = imgs[index].getAttribute("alt") || "";
        imgEl.setAttribute("src", src);
        imgEl.setAttribute("alt", alt);
        if (counter) counter.textContent = (index + 1) + " / " + imgs.length;
      };

      const openLightbox = () => {
        lightbox.classList.add("open");
        lightbox.setAttribute("aria-hidden", "false");
        document.documentElement.classList.add("noScroll");
      };

      const closeLightbox = () => {
        lightbox.classList.remove("open");
        lightbox.setAttribute("aria-hidden", "true");
        document.documentElement.classList.remove("noScroll");
        imgEl.removeAttribute("src");
        showNav();
        mode = "photos";
      };

      const openPhoto = (i) => {
        mode = "photos";
        showNav();
        setImage(i);
        openLightbox();
      };

      const openMap = () => {
        mode = "map";
        hideNav();
        imgEl.setAttribute("src", MAP_SRC);
        imgEl.setAttribute("alt", "Mapa de Argentina (ruta)");
        if (counter) counter.textContent = "Mapa";
        openLightbox();
      };

      const prev = () => setImage(index - 1);
      const next = () => setImage(index + 1);

      if (grid) {
        grid.addEventListener("click", (e) => {
          const targetImg = e.target && e.target.closest ? e.target.closest("img") : null;
          if (!targetImg) return;
          const i = imgs.indexOf(targetImg);
          if (i >= 0) openPhoto(i);
        });
      }

      if (openMapBtn) openMapBtn.addEventListener("click", openMap);

      if (btnClose) btnClose.addEventListener("click", closeLightbox);
      if (backdrop) backdrop.addEventListener("click", closeLightbox);

      if (btnPrev) btnPrev.addEventListener("click", () => { if (mode === "photos") prev(); });
      if (btnNext) btnNext.addEventListener("click", () => { if (mode === "photos") next(); });

      window.addEventListener("keydown", (e) => {
        if (!lightbox.classList.contains("open")) return;
        if (e.key === "Escape") closeLightbox();
        if (mode !== "photos") return;
        if (e.key === "ArrowLeft") prev();
        if (e.key === "ArrowRight") next();
      });

      let startX = 0;
      let dx = 0;

      const onTouchStart = (e) => {
        if (!lightbox.classList.contains("open")) return;
        if (mode !== "photos") return;
        startX = e.touches[0].clientX;
        dx = 0;
      };

      const onTouchMove = (e) => {
        if (!lightbox.classList.contains("open")) return;
        if (mode !== "photos") return;
        dx = e.touches[0].clientX - startX;
      };

      const onTouchEnd = () => {
        if (!lightbox.classList.contains("open")) return;
        if (mode !== "photos") return;
        if (Math.abs(dx) > 45) {
          if (dx > 0) prev();
          else next();
        }
        startX = 0;
        dx = 0;
      };

      lightbox.addEventListener("touchstart", onTouchStart, { passive: true });
      lightbox.addEventListener("touchmove", onTouchMove, { passive: true });
      lightbox.addEventListener("touchend", onTouchEnd, { passive: true });
    })();
  </script>
</BaseLayout>


