---
import BaseLayout from "../../layouts/BaseLayout.astro";
import itinerarioRaw from "../../data/mexico.js";

type Dia = {
  day: number;
  title: string;
  text?: string;
};

const itinerario: Dia[] = Array.isArray(itinerarioRaw)
  ? [...(itinerarioRaw as Dia[])].sort((a, b) => (a.day ?? 0) - (b.day ?? 0))
  : [];

const daysSet = new Set(itinerario.map((d) => d.day));

const nextExistingDay = (day: number): number | null => {
  for (let i = day + 1; i <= 365; i++) {
    if (daysSet.has(i)) return i;
  }
  return null;
};
---

<BaseLayout title="México | Ruta Base">
  <style>
    .hero{
      position: relative;
      border-radius: 16px;
      overflow: hidden;
      border: 0;
      box-shadow: none;
      background: transparent;
      margin-bottom: 12px;
    }

    .heroImg{
      width: 100%;
      height: 320px;
      object-fit: cover;
      display: block;
      border-radius: 16px;
      border: 1px solid rgba(0,0,0,0.08);
      box-shadow: 0 10px 24px rgba(0,0,0,0.10);
    }

    .pad{
      position: absolute;
      left: 0;
      right: 0;
      bottom: 0;
      padding: 10px;
      display: flex;
      justify-content: flex-start;
      background: linear-gradient(180deg, rgba(0,0,0,0) 0%, rgba(0,0,0,0.35) 100%);
    }
    .caption{
      display: inline-block;
      padding: 4px 8px;
      border-radius: 10px;
      background: rgba(255,255,255,0.35);
      border: 1px solid rgba(0,0,0,0.1);
      margin: 0;
      font-size: 13px;
      font-weight: 600;
      font-style: italic;
      color: #fff;
      text-shadow: 0 1px 2px rgba(0,0,0,0.35);
    }
    .pageTitle{
      margin-top: 0;
      margin-bottom: 10px;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }
    .flag-mx{
      height: 28px;
      width: auto;
      display: inline-block;
      border-radius: 3px;
      border: 1px solid rgba(0,0,0,0.15);
      box-shadow: 0 1px 3px rgba(0,0,0,0.15);
      vertical-align: -0.1em;
      object-fit: contain;
    }

    .toc{
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin: 10px 0 16px;
      position: sticky;
      top: 10px;
      z-index: 5;
      backdrop-filter: blur(6px);
      background: rgba(255,255,255,0.7);
      padding: 8px;
      border-radius: 12px;
    }

    .toc a{
      display: inline-block;
      text-decoration: none;
      color: #1a0b2e;
      padding: 6px 10px;
      border-radius: 10px;
      background: rgba(255,255,255,0.65);
      border: 1px solid rgba(0,0,0,0.08);
      font-weight: 700;
      font-size: 13px;
    }

    .toc a:hover{
      background: rgba(155,120,255,0.22);
    }

    /* Secciones plegables */
    details.sec{
      border: 1px solid rgba(0,0,0,0.08);
      border-radius: 14px;
      background: rgba(255,255,255,0.75);
      margin-bottom: 12px;
      overflow: hidden;
    }

    summary.secSummary{
      list-style: none;
      cursor: pointer;
      padding: 14px;
      user-select: none;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      color: #1a0b2e;
      font-weight: 900;
      font-size: 18px;
    }
    /* Solo TOC arriba: ocultar títulos repetidos */

    /* Hoteles */
    .hotelList{
      display: grid;
      gap: 12px;
    }
    .hotelItem{
      border: 1px solid rgba(0,0,0,0.08);
      border-radius: 12px;
      background: rgba(255,255,255,0.6);
      overflow: hidden;
    }
    .hotelToggle{
      width: 100%;
      text-align: left;
      padding: 12px 14px;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      font-weight: 800;
      color: #1a0b2e;
    }
    .hotelTitle{
      display: inline-flex;
      align-items: center;
      gap: 10px;
    }
    .hotelStars{
      color: #f3c94d;
      text-shadow: 0 1px 2px rgba(0,0,0,0.2);
      font-size: 16px;
      letter-spacing: 1px;
    }
    .hotelCaret{
      font-size: 18px;
      opacity: 0.7;
      transform: rotate(-90deg);
      transition: transform 0.2s ease;
    }
    .hotelItem[open] .hotelCaret{
      transform: rotate(0deg);
    }
    .hotelPanel{
      padding: 12px 14px 16px;
      display: grid;
      gap: 12px;
    }
    .hotelInfo{
      display: grid;
      gap: 10px;
      font-size: 14px;
      color: #2a1a3d;
    }
    .hotelLabel{
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      opacity: 0.7;
      margin-bottom: 4px;
    }
    .hotelValue{
      font-weight: 600;
    }
    .hotelLink{
      font-weight: 700;
      color: #3a1b6f;
      text-decoration: none;
    }
    .hotelLink:hover{
      text-decoration: underline;
    }
    .hotelMap{
      width: 100%;
      height: 240px;
      border: 0;
      border-radius: 12px;
    }
    .hotelPhotos{
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 8px;
    }
    .hotelPhoto{
      width: 100%;
      height: 120px;
      object-fit: cover;
      border-radius: 10px;
      display: block;
      border: 1px solid rgba(0,0,0,0.08);
      box-shadow: 0 6px 14px rgba(0,0,0,0.12);
    }
    summary.secSummary{ display: none; }

    summary.secSummary::-webkit-details-marker{ display:none; }

    .secCaret{
      font-size: 18px;
      opacity: 0.7;
      transform: rotate(-90deg);
      transition: transform 0.18s ease;
    }

    details[open] .secCaret{
      transform: rotate(0deg);
    }

    .secBody{
      padding: 0 14px 14px 14px;
      border-top: 1px solid rgba(0,0,0,0.08);
    }
    details.sec{
      border: 0;
      background: transparent;
      margin-bottom: 0;
    }
    details.sec[open]{
      border: 1px solid rgba(0,0,0,0.08);
      border-radius: 14px;
      background: rgba(255,255,255,0.75);
      margin-bottom: 12px;
    }

    .dots{
      color: #666;
      margin: 10px 0 0 0;
    }

    /* Itinerario */
    .dayList{
      display: grid;
      gap: 10px;
      margin-top: 10px;
    }

    details.day{
      border: 1px solid rgba(0,0,0,0.08);
      border-radius: 12px;
      background: rgba(255,255,255,0.65);
      overflow: hidden;
    }

    summary.daySummary{
      list-style: none;
      cursor: pointer;
      padding: 12px;
      font-weight: 800;
      color: #1a0b2e;
      user-select: none;
    }

    summary.daySummary::-webkit-details-marker{ display:none; }

    .dayBody{
      padding: 0 12px 12px 12px;
      border-top: 1px solid rgba(0,0,0,0.08);
    }

    .dayText{
      margin: 10px 0 0 0;
      color: #222;
      line-height: 1.7;
      white-space: pre-wrap;
    }

    .nextRow{
      margin-top: 12px;
      display: flex;
      justify-content: flex-end;
    }

    .nextBtn{
      display: inline-block;
      text-decoration: none;
      color: #1a0b2e;
      font-weight: 800;
      font-size: 13px;
      padding: 8px 10px;
      border-radius: 10px;
      background: rgba(155,120,255,0.22);
      border: 1px solid rgba(155,120,255,0.45);
    }

    .nextBtn:hover{
      background: rgba(155,120,255,0.30);
    }

    /* MAPA (pequeño + clic para ampliar) */
    .mapWrap{
      display: flex;
      justify-content: center;
      margin-top: 10px;
    }

    .mapBox{
      width: 21%;
      max-width: 240px;
      border-radius: 14px;
      overflow: hidden;
      border: 1px solid rgba(0,0,0,0.08);
      background: rgba(255,255,255,0.65);
    }

    .mapBtn{
      padding: 0;
      border: 0;
      background: transparent;
      cursor: pointer;
      display: block;
      width: 100%;
    }

    .mapImg{
      width: 100%;
      height: auto;
      display: block;
    }

    @media (max-width: 800px){
      .mapBox{ width: 55%; max-width: 340px; }
    }

    /* GALERIA */
    #galeria h3{
      margin: 14px 0 8px 0;
      font-size: 15px;
      color: #1a0b2e;
    }

    .videoGrid{
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
      margin-top: 10px;
      margin-bottom: 18px;
    }

    @media (max-width: 900px){
      .videoGrid{ grid-template-columns: repeat(2, 1fr); }
    }
    @media (max-width: 520px){
      .videoGrid{ grid-template-columns: 1fr; }
    }

    .videoGrid iframe{
      width: 100%;
      aspect-ratio: 16 / 9;
      height: auto;
      border-radius: 10px;
      border: 1px solid rgba(0,0,0,0.10);
      background: rgba(0,0,0,0.04);
    }

    .photoGrid{
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
      gap: 10px;
      margin-top: 10px;
    }

    .photoBtn{
      padding: 0;
      border: 0;
      background: transparent;
      cursor: pointer;
    }

    .photoBtn img{
      width: 100%;
      height: 140px;
      object-fit: cover;
      border-radius: 10px;
      border: 1px solid rgba(0,0,0,0.10);
      display: block;
      transition: transform 0.18s ease;
    }

    .photoBtn:hover img{
      transform: scale(1.03);
    }

    .noScroll{
      overflow: hidden;
    }

    .lightbox{
      position: fixed;
      inset: 0;
      display: none;
      z-index: 9999;
    }

    .lightbox.open{
      display: block;
    }

    .lbBackdrop{
      position: absolute;
      inset: 0;
      background: rgba(0,0,0,0.75);
    }

    .lbPanel{
      position: absolute;
      inset: 0;
      display: grid;
      place-items: center;
      padding: 20px;
    }

    .lbImg{
      max-width: min(92vw, 980px);
      max-height: 82vh;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(255,255,255,0.06);
    }

    .lbClose{
      position: absolute;
      top: 14px;
      right: 14px;
      width: 40px;
      height: 40px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(0,0,0,0.35);
      color: #fff;
      font-size: 26px;
      line-height: 36px;
      cursor: pointer;
    }

    .lbNav{
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      width: 46px;
      height: 56px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(0,0,0,0.35);
      color: #fff;
      font-size: 34px;
      cursor: pointer;
      user-select: none;
    }

    .lbPrev{ left: 14px; }
    .lbNext{ right: 14px; }

    .lbCounter{
      position: absolute;
      bottom: 14px;
      left: 50%;
      transform: translateX(-50%);
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(0,0,0,0.35);
      color: #fff;
      font-weight: 700;
      font-size: 12px;
    }
  </style>

  <div style="position:relative; width:100%;">
    <div style="position:absolute; top:-16px; right:-6px; z-index:5; display:flex; align-items:center;">
      <a class="titleArrow" href="/viajes/argentina" aria-label="Anterior" style="width:72px; height:72px;">
        <img src="/giroizquierda.png" alt="" style="width:72px; height:72px; object-fit:contain; display:block;" />
      </a>
      <a class="titleArrow" href="/viajes/francia" aria-label="Siguiente" style="width:72px; height:72px; margin-left:-8px;">
        <img src="/giroderecha.png" alt="" style="width:72px; height:72px; object-fit:contain; display:block;" />
      </a>
    </div>
    <div class="titleRow" style="position:relative; width:100%;">
  <div class="titleNav" style="position:absolute; top:-16px; right:-6px; z-index:5; display:flex; align-items:center;"><a class="titleArrow" href="/viajes/argentina" aria-label="Anterior"><img src="/giroizquierda.png" alt="" style="width:72px; height:72px; object-fit:contain; display:block;" /></a><a class="titleArrow" href="/viajes/francia" aria-label="Siguiente" style="margin-left:-8px;"><img src="/giroderecha.png" alt="" style="width:72px; height:72px; object-fit:contain; display:block;" /></a></div>
  <h1 class="pageTitle">
      México
      <img class="flag-mx" src="/flags/flagmexico.gif" alt="Bandera de México" />
    </h1>
</div>
  </div>

  <div class="hero">
    <img class="heroImg" src="/mexicoyo.jpg" alt="México" />
    <div class="pad">
      <p class="muted caption">México y su cultura azteca.</p>
    </div>
  </div>

    <div class="toc">
    <a href="#resumen">Resumen</a>
    <a href="#itinerario">Itinerario</a>
    <a href="#imprescindibles">Imprescindibles</a>
    <a href="#costes">Costes</a>
    <a href="#hoteles">Hoteles</a>
    <a href="#mapa">Mapa</a>
    <a href="#galeria">Galería</a>
  </div>

  <details class="sec" id="resumen">
    <summary class="secSummary">
      <span>Resumen</span><span class="secCaret">&#9662;</span>
    </summary>
    <div class="secBody">
      <p>
        Historias de México Lindo es la crónica de un viaje por México tras la pandemia donde se narra, día a día, lo que vive el autor en diferentes lugares del país. El blog arranca dando la bienvenida a la “nueva aventura por la antigua tierra de los Mayas”, lo que ya sitúa el tono: un recorrido por lugares con historia, cultura y paisaje variado.
        <br /><br />
        En una de las entradas, durante lo que llaman Día 13, visitan las ruinas arqueológicas de Monte Albán, una de las zonas históricas más conocidas del país, localizada cerca de Oaxaca. Tras la visita, pasean por las calles de Oaxaca, comen en un restaurante local, participan en un taller de alebrijes, prueban chocolate artesanal, recorren el mercado y cierran el día con músicos callejeros.
        <br /><br />
        Ese día resume bien lo que ofrece el blog: historia ancestral, ciudades vivas, gastronomía y experiencias culturales contadas desde dentro, paso a paso.
      </p>
    </div>
  </details>

  <details class="sec" id="itinerario">
    <summary class="secSummary">
      <span>Itinerario</span><span class="secCaret">&#9662;</span>
    </summary>
    <div class="secBody">
      <div class="dayList">
        {itinerario.map((d) => {
          const nextDay = nextExistingDay(d.day);
          const hasText = typeof d.text === "string" && d.text.trim().length > 0;

          return (
            <details class="day" id={`dia-${d.day}`}>
              <summary class="daySummary">Día {d.day} — {d.title}</summary>

              <div class="dayBody">
                {hasText ? <p class="dayText">{d.text}</p> : <p class="dots"><</p>}

                {nextDay && (
                  <div class="nextRow">
                    <a class="nextBtn" href={`#dia-${nextDay}`}>Siguiente día &#10148;</a>
                  </div>
                )}
              </div>
            </details>
          );
        })}
      </div>
    </div>
  </details>

  <details class="sec" id="imprescindibles">
    <summary class="secSummary">
      <span>Imprescindibles</span><span class="secCaret">&#9662;</span>
    </summary>
    <div class="secBody">
      <p class="dots"><</p>
    </div>
  </details>

  <details class="sec" id="costes">
    <summary class="secSummary">
      <span>Costes</span><span class="secCaret">&#9662;</span>
    </summary>
    <div class="secBody">
      <p class="dots"><</p>
    </div>
  </details>

  <details class="sec" id="hoteles">
    <summary class="secSummary"><span>Hoteles</span><span class="secCaret">&#9662;</span></summary>
    <div class="secBody">
      <div class="hotelList">
        <details class="hotelItem">
          <summary class="hotelToggle">
            <span class="hotelTitle">
              Barceló Guadalajara
              <span class="hotelStars" aria-hidden="true">&#9733;&#9733;&#9733;&#9733;&#9733;</span>
            </span>
            <span class="hotelCaret">&#9662;</span>
          </summary>
          <div class="hotelPanel">
            <div class="hotelInfo">
              <div>
                <div class="hotelLabel">Dirección</div>
                <div class="hotelValue">Av de Las Rosas 2933, Rinconada del Bosque, 44530 Guadalajara, Jal., México</div>
              </div>
              <div>
                <div class="hotelLabel">Nota</div>
                <div class="hotelValue">Antes era un Hilton</div>
              </div>
              <div>
                <div class="hotelLabel">Web</div>
                <a class="hotelLink" href="https://www.barcelo.com/es-mx/barcelo-guadalajara/?utm_source=google&utm_medium=organic&utm_campaign=my_business&utm_content=41190" target="_blank" rel="noreferrer">barcelo.com</a>
              </div>
              <div>
                <div class="hotelLabel">Precio</div>
                <div class="hotelValue">135 &euro; la noche</div>
              </div>
            </div>
            <div class="hotelPhotos">
              <img class="hotelPhoto" src="/hoteles/hgua1.jpg" alt="Barceló Guadalajara - foto 1" loading="lazy" />
              <img class="hotelPhoto" src="/hoteles/hgua2.jpg" alt="Barceló Guadalajara - foto 2" loading="lazy" />
              <img class="hotelPhoto" src="/hoteles/hgua3.jpg" alt="Barceló Guadalajara - foto 3" loading="lazy" />
            </div>
            <iframe
              class="hotelMap"
              src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3572.9744412055816!2d-103.3921547605883!3d20.65355130063983!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x842145c130765ee9%3A0x4b8359e36be3e68d!2sBarcel%C3%B3%20Guadalajara!5e1!3m2!1ses!2ses!4v1770328171142!5m2!1ses!2ses"
              allowfullscreen=""
              loading="lazy"
              referrerpolicy="no-referrer-when-downgrade"
              title="Mapa Barceló Guadalajara"
            ></iframe>
          </div>
        </details>
        <details class="hotelItem">
          <summary class="hotelToggle">
            <span class="hotelTitle">
              Meliá Puerto Vallarta
              <span class="hotelStars" aria-hidden="true">&#9733;&#9733;&#9733;&#9733;</span>
            </span>
            <span class="hotelCaret">&#9662;</span>
          </summary>
          <div class="hotelPanel">
            <div class="hotelInfo">
              <div>
                <div class="hotelLabel">Dirección</div>
                <div class="hotelValue">Av. Paseo de la Marina Sur, Marina Vallarta, 48333 Puerto Vallarta, Jal., México</div>
              </div>
              <div>
                <div class="hotelLabel">Web</div>
                <a class="hotelLink" href="https://www.melia.com/en/hotels/mexico/puerto-vallarta/melia-puerto-vallarta?utm_campaign=google&utm_content=5835&utm_medium=organic&utm_source=directories" target="_blank" rel="noreferrer">melia.com</a>
              </div>
              <div>
                <div class="hotelLabel">Precio</div>
                <div class="hotelValue">327 &euro; la noche</div>
              </div>
            </div>
            <div class="hotelPhotos">
              <img class="hotelPhoto" src="/hoteles/hpue1.jpg" alt="Meliá Puerto Vallarta - foto 1" loading="lazy" />
              <img class="hotelPhoto" src="/hoteles/hpue2.jpg" alt="Meliá Puerto Vallarta - foto 2" loading="lazy" />
              <img class="hotelPhoto" src="/hoteles/hpue3.jpg" alt="Meliá Puerto Vallarta - foto 3" loading="lazy" />
              <img class="hotelPhoto" src="/hoteles/hpue4.jpg" alt="Meliá Puerto Vallarta - foto 4" loading="lazy" />
            </div>
            <iframe
              class="hotelMap"
              src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d7466.396206454931!2d-105.2528342!3d20.6615179!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x842145ba3f88d58d%3A0xb80c7197bf4dfb73!2sMeli%C3%A1%20Puerto%20Vallarta!5e0!3m2!1ses!2ses!4v1770328643291!5m2!1ses!2ses"
              allowfullscreen=""
              loading="lazy"
              referrerpolicy="no-referrer-when-downgrade"
              title="Mapa Meliá Puerto Vallarta"
            ></iframe>
          </div>
        </details>
        <details class="hotelItem">
          <summary class="hotelToggle">
            <span class="hotelTitle">
              Camino Real Acapulco Diamante
              <span class="hotelStars" aria-hidden="true">&#9733;&#9733;&#9733;&#9733;</span>
            </span>
            <span class="hotelCaret">&#9662;</span>
          </summary>
          <div class="hotelPanel">
            <div class="hotelInfo">
              <div>
                <div class="hotelLabel">Dirección</div>
                <div class="hotelValue">Escénica S/N, Pichilingue, 39880 Acapulco de Juárez, Gro., México</div>
              </div>
              <div>
                <div class="hotelLabel">Web</div>
                <a class="hotelLink" href="https://www.caminoreal.com/caminoreal/camino-real-acapulco-diamante" target="_blank" rel="noreferrer">caminoreal.com</a>
              </div>
              <div>
                <div class="hotelLabel">Precio</div>
                <div class="hotelValue">155 &euro; la noche</div>
              </div>
            </div>
            <div class="hotelPhotos">
              <img class="hotelPhoto" src="/hoteles/haca1.jpg" alt="Camino Real Acapulco Diamante - foto 1" loading="lazy" />
              <img class="hotelPhoto" src="/hoteles/haca2.jpg" alt="Camino Real Acapulco Diamante - foto 2" loading="lazy" />
              <img class="hotelPhoto" src="/hoteles/haca3.jpg" alt="Camino Real Acapulco Diamante - foto 3" loading="lazy" />
              <img class="hotelPhoto" src="/hoteles/haca4.jpg" alt="Camino Real Acapulco Diamante - foto 4" loading="lazy" />
            </div>
            <iframe
              class="hotelMap"
              src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d1587.954716122734!2d-99.84976415615142!3d16.811125930922472!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x85ca59042c078513%3A0xdb371627e8552bdd!2sCamino%20Real%20Acapulco%20Diamante!5e1!3m2!1ses!2ses!4v1770330811868!5m2!1ses!2ses"
              allowfullscreen=""
              loading="lazy"
              referrerpolicy="no-referrer-when-downgrade"
              title="Mapa Camino Real Acapulco Diamante"
            ></iframe>
          </div>
        </details>
        <details class="hotelItem">
          <summary class="hotelToggle">
            <span class="hotelTitle">
              Barceló México Reforma
              <span class="hotelStars" aria-hidden="true">&#9733;&#9733;&#9733;&#9733;&#9733;</span>
            </span>
            <span class="hotelCaret">&#9662;</span>
          </summary>
          <div class="hotelPanel">
            <div class="hotelInfo">
              <div>
                <div class="hotelLabel">Dirección</div>
                <div class="hotelValue">Av. P.º de la Reforma 1, Tabacalera, Cuauhtémoc, 06030 Ciudad de México, CDMX, México</div>
              </div>
              <div>
                <div class="hotelLabel">Web</div>
                <a class="hotelLink" href="https://www.barcelo.com/es-mx/barcelo-mexico-reforma/?utm_source=google&utm_medium=organic&utm_campaign=my_business&utm_content=7345" target="_blank" rel="noreferrer">barcelo.com</a>
              </div>
              <div>
                <div class="hotelLabel">Precio</div>
                <div class="hotelValue">131 &euro; la noche</div>
              </div>
            </div>
            <div class="hotelPhotos">
              <img class="hotelPhoto" src="/hoteles/hmex1.jpg" alt="Barceló México Reforma - foto 1" loading="lazy" />
              <img class="hotelPhoto" src="/hoteles/hmex2.jpg" alt="Barceló México Reforma - foto 2" loading="lazy" />
              <img class="hotelPhoto" src="/hoteles/hmex3.jpg" alt="Barceló México Reforma - foto 3" loading="lazy" />
              <img class="hotelPhoto" src="/hoteles/hmex4.jpg" alt="Barceló México Reforma - foto 4" loading="lazy" />
            </div>
            <iframe
              class="hotelMap"
              src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3762.4731313688053!2d-99.15361066053057!3d19.4351527819204!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x85d201e1a9788123%3A0xa83028dc76da793c!2sBarcel%C3%B3%20M%C3%A9xico%20Reforma!5e0!3m2!1ses!2ses!4v1770331587046!5m2!1ses!2ses"
              allowfullscreen=""
              loading="lazy"
              referrerpolicy="no-referrer-when-downgrade"
              title="Mapa Barceló México Reforma"
            ></iframe>
          </div>
        </details>
        <details class="hotelItem">
          <summary class="hotelToggle">
            <span class="hotelTitle">
              Holiday Inn Express Oaxaca
              <span class="hotelStars" aria-hidden="true">&#9733;&#9733;&#9733;&#9733;</span>
            </span>
            <span class="hotelCaret">&#9662;</span>
          </summary>
          <div class="hotelPanel">
            <div class="hotelInfo">
              <div>
                <div class="hotelLabel">Dirección</div>
                <div class="hotelValue">Díaz Quintas 115, Centro, 68000 Oaxaca de Juárez, Oax., México</div>
              </div>
              <div>
                <div class="hotelLabel">Web</div>
                <a class="hotelLink" href="https://www.ihg.com/holidayinnexpress/hotels/us/en/oaxaca/oaxmx/hoteldetail?cm_mmc=GoogleMaps-_-EX-_-MX-_-OAXMX" target="_blank" rel="noreferrer">ihg.com</a>
              </div>
              <div>
                <div class="hotelLabel">Precio</div>
                <div class="hotelValue">166 &euro; la noche</div>
              </div>
            </div>
            <div class="hotelPhotos">
              <img class="hotelPhoto" src="/hoteles/hoax1.jpg" alt="Holiday Inn Express Oaxaca - foto 1" loading="lazy" />
              <img class="hotelPhoto" src="/hoteles/hoax2.jpg" alt="Holiday Inn Express Oaxaca - foto 2" loading="lazy" />
              <img class="hotelPhoto" src="/hoteles/hoax3.jpg" alt="Holiday Inn Express Oaxaca - foto 3" loading="lazy" />
              <img class="hotelPhoto" src="/hoteles/hoax4.jpg" alt="Holiday Inn Express Oaxaca - foto 4" loading="lazy" />
            </div>
            <iframe
              class="hotelMap"
              src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3814.0407339723724!2d-96.721947!3d17.070660099999998!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x85c7223b447e7053%3A0x481389e4c19e48c3!2sHoliday%20Inn%20Express!5e0!3m2!1ses!2ses!4v1770332414526!5m2!1ses!2ses"
              allowfullscreen=""
              loading="lazy"
              referrerpolicy="no-referrer-when-downgrade"
              title="Mapa Holiday Inn Express Oaxaca"
            ></iframe>
          </div>
        </details>
        <details class="hotelItem">
          <summary class="hotelToggle">
            <span class="hotelTitle">
              Marriott Tuxtla Gutiérrez
              <span class="hotelStars" aria-hidden="true">&#9733;&#9733;&#9733;&#9733;&#9733;</span>
            </span>
            <span class="hotelCaret">&#9662;</span>
          </summary>
          <div class="hotelPanel">
            <div class="hotelInfo">
              <div>
                <div class="hotelLabel">Dirección</div>
                <div class="hotelValue">Blvd. Belisario Domínguez 1195, Sin Nombre, Santa Elena, 29060 Tuxtla Gutiérrez, Chis., México</div>
              </div>
              <div>
                <div class="hotelLabel">Web</div>
                <a class="hotelLink" href="https://www.marriott.com/en-us/hotels/tgzmc-marriott-tuxtla-gutierrez-hotel/overview/?scid=f2ae0541-1279-4f24-b197-a979c79310b0" target="_blank" rel="noreferrer">marriott.com</a>
              </div>
              <div>
                <div class="hotelLabel">Precio</div>
                <div class="hotelValue">71 &euro; la noche</div>
              </div>
            </div>
            <div class="hotelPhotos">
              <img class="hotelPhoto" src="/hoteles/htux1.jpg" alt="Marriott Tuxtla Gutiérrez - foto 1" loading="lazy" />
              <img class="hotelPhoto" src="/hoteles/htux2.jpg" alt="Marriott Tuxtla Gutiérrez - foto 2" loading="lazy" />
              <img class="hotelPhoto" src="/hoteles/htux3.jpg" alt="Marriott Tuxtla Gutiérrez - foto 3" loading="lazy" />
              <img class="hotelPhoto" src="/hoteles/htux4.jpg" alt="Marriott Tuxtla Gutiérrez - foto 4" loading="lazy" />
            </div>
            <iframe
              class="hotelMap"
              src="https://www.google.com/maps/embed?pb=!1m14!1m8!1m3!1d3820.458111965002!2d-93.14217699999999!3d16.7538686!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x85ecd9040d530b65%3A0x9cda45cdd4a92b92!2sMarriott%20%5BTuxtla%20Guti%C3%A9rrez%5D!5e0!3m2!1ses!2ses!4v1770332923323!5m2!1ses!2ses"
              allowfullscreen=""
              loading="lazy"
              referrerpolicy="no-referrer-when-downgrade"
              title="Mapa Marriott Tuxtla Gutiérrez"
            ></iframe>
          </div>
        </details>
        <details class="hotelItem">
          <summary class="hotelToggle">
            <span class="hotelTitle">
              Hoteles Villa Mercedes San Cristóbal
              <span class="hotelStars" aria-hidden="true">&#9733;&#9733;&#9733;&#9733;</span>
            </span>
            <span class="hotelCaret">&#9662;</span>
          </summary>
          <div class="hotelPanel">
            <div class="hotelInfo">
              <div>
                <div class="hotelLabel">Dirección</div>
                <div class="hotelValue">Diagonal Hermanos Paniagua 32, Barrio de Fátima, 29264 San Cristóbal de las Casas, Chis., México</div>
              </div>
              <div>
                <div class="hotelLabel">Web</div>
                <a class="hotelLink" href="https://hotelvmsancristobaldelascasas.com/?utm_source=Google&utm_medium=GMB&utm_campaign=FichaGoogle" target="_blank" rel="noreferrer">hotelvmsancristobaldelascasas.com</a>
              </div>
              <div>
                <div class="hotelLabel">Precio</div>
                <div class="hotelValue">73 &euro; la noche</div>
              </div>
            </div>
            <div class="hotelPhotos">
              <img class="hotelPhoto" src="/hoteles/hmer1.jpg" alt="Hoteles Villa Mercedes San Cristóbal - foto 1" loading="lazy" />
              <img class="hotelPhoto" src="/hoteles/hmer2.jpg" alt="Hoteles Villa Mercedes San Cristóbal - foto 2" loading="lazy" />
              <img class="hotelPhoto" src="/hoteles/hmer3.jpg" alt="Hoteles Villa Mercedes San Cristóbal - foto 3" loading="lazy" />
              <img class="hotelPhoto" src="/hoteles/hmer4.jpg" alt="Hoteles Villa Mercedes San Cristóbal - foto 4" loading="lazy" />
            </div>
            <iframe
              class="hotelMap"
              src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3820.8900980638728!2d-92.6538015!3d16.732334599999998!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x85d2023e42b369ed%3A0xabb8931c94f03aa6!2sHoteles%20Villa%20Mercedes%20San%20Cristobal!5e0!3m2!1ses!2ses!4v1770333295087!5m2!1ses!2ses"
              allowfullscreen=""
              loading="lazy"
              referrerpolicy="no-referrer-when-downgrade"
              title="Mapa Hoteles Villa Mercedes San Cristóbal"
            ></iframe>
          </div>
        </details>
        <details class="hotelItem">
          <summary class="hotelToggle">
            <span class="hotelTitle">
              Hotel Villa Mercedes Palenque
              <span class="hotelStars" aria-hidden="true">&#9733;&#9733;&#9733;</span>
            </span>
            <span class="hotelCaret">&#9662;</span>
          </summary>
          <div class="hotelPanel">
            <div class="hotelInfo">
              <div>
                <div class="hotelLabel">Dirección</div>
                <div class="hotelValue">Ruinas-Palenque km 2.9, 29960 Palenque, Chis., México</div>
              </div>
              <div>
                <div class="hotelLabel">Web</div>
                <a class="hotelLink" href="https://hotelvmpalenque.com/es/?utm_source=Google&utm_medium=GMB&utm_campaign=FichaGoogle" target="_blank" rel="noreferrer">hotelvmpalenque.com</a>
              </div>
              <div>
                <div class="hotelLabel">Precio</div>
                <div class="hotelValue">88 &euro; la noche</div>
              </div>
            </div>
            <div class="hotelPhotos">
              <img class="hotelPhoto" src="/hoteles/hpal1.jpg" alt="Hotel Villa Mercedes Palenque - foto 1" loading="lazy" />
              <img class="hotelPhoto" src="/hoteles/hpal2.jpg" alt="Hotel Villa Mercedes Palenque - foto 2" loading="lazy" />
              <img class="hotelPhoto" src="/hoteles/hpal3.jpg" alt="Hotel Villa Mercedes Palenque - foto 3" loading="lazy" />
              <img class="hotelPhoto" src="/hoteles/hpal4.jpg" alt="Hotel Villa Mercedes Palenque - foto 4" loading="lazy" />
            </div>
            <iframe
              class="hotelMap"
              src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d866.4428022192801!2d-92.01741204201466!3d17.49789420252229!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x842737b2b20dc5c7%3A0x87fbbe2aea98f515!2sHotel%20Villa%20Mercedes%20Palenque!5e1!3m2!1ses!2ses!4v1770333929839!5m2!1ses!2ses"
              allowfullscreen=""
              loading="lazy"
              referrerpolicy="no-referrer-when-downgrade"
              title="Mapa Hotel Villa Mercedes Palenque"
            ></iframe>
          </div>
        </details>
        <details class="hotelItem">
          <summary class="hotelToggle">
            <span class="hotelTitle">
              Hotel Plaza Campeche
              <span class="hotelStars" aria-hidden="true">&#9733;&#9733;&#9733;</span>
            </span>
            <span class="hotelCaret">&#9662;</span>
          </summary>
          <div class="hotelPanel">
            <div class="hotelInfo">
              <div>
                <div class="hotelLabel">Dirección</div>
                <div class="hotelValue">C. 10 126, Zona Centro, 24000 San Francisco de Campeche, Camp., México</div>
              </div>
              <div>
                <div class="hotelLabel">Web</div>
                <a class="hotelLink" href="http://www.hotelplazacampeche.com/" target="_blank" rel="noreferrer">hotelplazacampeche.com</a>
              </div>
              <div>
                <div class="hotelLabel">Precio</div>
                <div class="hotelValue">96 &euro; la noche</div>
              </div>
            </div>
            <div class="hotelPhotos">
              <img class="hotelPhoto" src="/hoteles/hcam1.jpg" alt="Hotel Plaza Campeche - foto 1" loading="lazy" />
              <img class="hotelPhoto" src="/hoteles/hcam2.jpg" alt="Hotel Plaza Campeche - foto 2" loading="lazy" />
              <img class="hotelPhoto" src="/hoteles/hcam3.jpg" alt="Hotel Plaza Campeche - foto 3" loading="lazy" />
              <img class="hotelPhoto" src="/hoteles/hcam4.jpg" alt="Hotel Plaza Campeche - foto 4" loading="lazy" />
            </div>
            <iframe
              class="hotelMap"
              src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3591.5776779783027!2d-90.53650622505249!3d19.847047627315423!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x85f833fa2229b811%3A0x6e8b57191e04aaaa!2sHotel%20Plaza%20Campeche!5e1!3m2!1ses!2ses!4v1770334256323!5m2!1ses!2ses"
              allowfullscreen=""
              loading="lazy"
              referrerpolicy="no-referrer-when-downgrade"
              title="Mapa Hotel Plaza Campeche"
            ></iframe>
          </div>
        </details>
        <details class="hotelItem">
          <summary class="hotelToggle">
            <span class="hotelTitle">
              NH Collection Mérida Paseo Montejo
              <span class="hotelStars" aria-hidden="true">&#9733;&#9733;&#9733;&#9733;</span>
            </span>
            <span class="hotelCaret">&#9662;</span>
          </summary>
          <div class="hotelPanel">
            <div class="hotelInfo">
              <div>
                <div class="hotelLabel">Dirección</div>
                <div class="hotelValue">C. 60 346, Zona Paseo Montejo, Centro, 97000 Mérida, Yuc., México</div>
              </div>
              <div>
                <div class="hotelLabel">Web</div>
                <a class="hotelLink" href="https://www.nh-hotels.com/en/hotel/nh-collection-merida-paseo-montejo?utm_campaign=local-gmb&utm_medium=organic_search&utm_source=google_gmb" target="_blank" rel="noreferrer">nh-hotels.com</a>
              </div>
              <div>
                <div class="hotelLabel">Precio</div>
                <div class="hotelValue">111 &euro; la noche</div>
              </div>
            </div>
            <div class="hotelPhotos">
              <img class="hotelPhoto" src="/hoteles/hmeri1.jpg" alt="NH Collection Mérida Paseo Montejo - foto 1" loading="lazy" />
              <img class="hotelPhoto" src="/hoteles/hmeri2.jpg" alt="NH Collection Mérida Paseo Montejo - foto 2" loading="lazy" />
              <img class="hotelPhoto" src="/hoteles/hmeri3.jpg" alt="NH Collection Mérida Paseo Montejo - foto 3" loading="lazy" />
              <img class="hotelPhoto" src="/hoteles/hmeri4.jpg" alt="NH Collection Mérida Paseo Montejo - foto 4" loading="lazy" />
            </div>
            <iframe
              class="hotelMap"
              src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3565.153785526872!2d-89.6199704!3d20.9837354!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x8f5671a3811bdca9%3A0xf71f55e1b79aeb9d!2sHotel%20NH%20Collection%20M%C3%A9rida%20Paseo%20Montejo!5e1!3m2!1ses!2ses!4v1770334621764!5m2!1ses!2ses"
              allowfullscreen=""
              loading="lazy"
              referrerpolicy="no-referrer-when-downgrade"
              title="Mapa NH Collection Mérida Paseo Montejo"
            ></iframe>
          </div>
        </details>
        <details class="hotelItem">
          <summary class="hotelToggle">
            <span class="hotelTitle">
              Ocean Riviera Paradise
              <span class="hotelStars" aria-hidden="true">&#9733;&#9733;&#9733;&#9733;&#9733;</span>
            </span>
            <span class="hotelCaret">&#9662;</span>
          </summary>
          <div class="hotelPanel">
            <div class="hotelInfo">
              <div>
                <div class="hotelLabel">Dirección</div>
                <div class="hotelValue">Crta. Federal Cancún Chetumal, km 296 Manzana 020 Lote 007-1, 77710 Playa del Carmen, Q.R., México</div>
              </div>
              <div>
                <div class="hotelLabel">Web</div>
                <a class="hotelLink" href="https://www.oceanhotels.com/en/riviera-maya-hotels/ocean-riviera-paradise?utm_source=google_my_business&utm_medium=boton_sitio_web&utm_campaign=orp" target="_blank" rel="noreferrer">oceanhotels.com</a>
              </div>
              <div>
                <div class="hotelLabel">Precio</div>
                <div class="hotelValue">358 &euro; la noche</div>
              </div>
            </div>
            <div class="hotelPhotos">
              <img class="hotelPhoto" src="/hoteles/hqui1.jpg" alt="Ocean Riviera Paradise - foto 1" loading="lazy" />
              <img class="hotelPhoto" src="/hoteles/hqui2.jpg" alt="Ocean Riviera Paradise - foto 2" loading="lazy" />
              <img class="hotelPhoto" src="/hoteles/hqui3.jpg" alt="Ocean Riviera Paradise - foto 3" loading="lazy" />
              <img class="hotelPhoto" src="/hoteles/hqui4.jpg" alt="Ocean Riviera Paradise - foto 4" loading="lazy" />
              <img class="hotelPhoto" src="/hoteles/hqui5.jpg" alt="Ocean Riviera Paradise - foto 5" loading="lazy" />
            </div>
            <iframe
              class="hotelMap"
              src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d1866.4879457842158!2d-87.0355423!3d20.6705598!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x8f4e5d724fc7d22f%3A0x8cae5bc250ba1813!2sOcean%20Riviera%20Paradise!5e0!3m2!1ses!2ses!4v1770335114007!5m2!1ses!2ses"
              allowfullscreen=""
              loading="lazy"
              referrerpolicy="no-referrer-when-downgrade"
              title="Mapa Ocean Riviera Paradise"
            ></iframe>
          </div>
        </details>
      </div>
    </div>
  </details>
  <details class="sec" id="mapa">
    <summary class="secSummary">
      <span>Mapa</span><span class="secCaret">&#9662;</span>
    </summary>
    <div class="secBody">
      <div class="mapWrap">
        <div class="mapBox">
          <button class="mapBtn" type="button" id="openMap">
            <img class="mapImg" src="/maps/mapmex.png" alt="Mapa de México (ruta)" />
          </button>
        </div>
      </div>

      <p class="dots">Próximamente: mapa interactivo.</p>
    </div>
  </details>

  <details class="sec" id="galeria">
    <summary class="secSummary">
      <span>Galería</span><span class="secCaret">&#9662;</span>
    </summary>

    <div class="secBody">
      <h3>Vídeos</h3>
      <div class="videoGrid">
        <iframe src="https://www.youtube.com/embed/TU7oWZIwur8" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
        <iframe src="https://www.youtube.com/embed/sXOJrkP26rs" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
        <iframe src="https://www.youtube.com/embed/eIDZ0ZxSV5M" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
        <iframe src="https://www.youtube.com/embed/8SSYP6VHeKc" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
        <iframe src="https://www.youtube.com/embed/VRW1ABr31gs" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
        <iframe src="https://www.youtube.com/embed/fGOnMESCS1I" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
        <iframe src="https://www.youtube.com/embed/AFPzudzs8uc" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
        <iframe src="https://www.youtube.com/embed/ywgnsRvB_mE" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
        <iframe src="https://www.youtube.com/embed/ReCXF5U0hMU" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
      </div>

      <h3>Fotos</h3>
      <div class="photoGrid" id="photoGrid">
        <button class="photoBtn" type="button"><img src="/galeria/mex1.jpg" alt="México 1" loading="lazy" /></button>
        <button class="photoBtn" type="button"><img src="/galeria/mex2.jpg" alt="México 2" loading="lazy" /></button>
        <button class="photoBtn" type="button"><img src="/galeria/mex3.jpg" alt="México 3" loading="lazy" /></button>
        <button class="photoBtn" type="button"><img src="/galeria/mex4.jpg" alt="México 4" loading="lazy" /></button>
        <button class="photoBtn" type="button"><img src="/galeria/mex5.jpg" alt="México 5" loading="lazy" /></button>
        <button class="photoBtn" type="button"><img src="/galeria/mex6.jpg" alt="México 6" loading="lazy" /></button>
        <button class="photoBtn" type="button"><img src="/galeria/mex7.jpg" alt="México 7" loading="lazy" /></button>
        <button class="photoBtn" type="button"><img src="/galeria/mex8.jpg" alt="México 8" loading="lazy" /></button>
        <button class="photoBtn" type="button"><img src="/galeria/mex9.jpg" alt="México 9" loading="lazy" /></button>
        <button class="photoBtn" type="button"><img src="/galeria/mex10.jpg" alt="México 10" loading="lazy" /></button>
        <button class="photoBtn" type="button"><img src="/galeria/mex11.jpg" alt="México 11" loading="lazy" /></button>
        <button class="photoBtn" type="button"><img src="/galeria/mex12.jpg" alt="México 12" loading="lazy" /></button>
        <button class="photoBtn" type="button"><img src="/galeria/mex13.jpg" alt="México 13" loading="lazy" /></button>
        <button class="photoBtn" type="button"><img src="/galeria/mex14.jpg" alt="México 14" loading="lazy" /></button>
        <button class="photoBtn" type="button"><img src="/galeria/mex15.jpg" alt="México 15" loading="lazy" /></button>
        <button class="photoBtn" type="button"><img src="/galeria/mex16.jpg" alt="México 16" loading="lazy" /></button>
        <button class="photoBtn" type="button"><img src="/galeria/mex17.jpg" alt="México 17" loading="lazy" /></button>
        <button class="photoBtn" type="button"><img src="/galeria/mex18.jpg" alt="México 18" loading="lazy" /></button>
        <button class="photoBtn" type="button"><img src="/galeria/mex19.jpg" alt="México 19" loading="lazy" /></button>
        <button class="photoBtn" type="button"><img src="/galeria/mex20.jpg" alt="México 20" loading="lazy" /></button>
      </div>
    </div>
  </details>

  <!-- LIGHTBOX (fotos + mapa) -->
  <div class="lightbox" id="lightbox" aria-hidden="true">
        <div class="lbBackdrop" id="lbBackdrop"></div>

        <div class="lbPanel" role="dialog" aria-modal="true" aria-label="Galería">
          <button class="lbClose" type="button" id="lbClose" aria-label="Cerrar">×</button>

          <button class="lbNav lbPrev" type="button" id="lbPrev" aria-label="Anterior"><</button>
          <img class="lbImg" id="lbImg" alt="" />
          <button class="lbNav lbNext" type="button" id="lbNext" aria-label="Siguiente">></button>

          <div class="lbCounter" id="lbCounter">1 / 1</div>
        </div>
      </div>

  <script is:inline>
    (function () {
      // --- SECCIONES: abrir por hash / toc ---
      const getDetailsById = (id) => document.getElementById(id);

      const openSection = (id) => {
        const d = getDetailsById(id);
        if (d && d.tagName.toLowerCase() === "details") d.open = true;
        return d;
      };

      const closeAllSectionsExcept = (keepId) => {
        document.querySelectorAll("details.sec").forEach((d) => {
          if (d.id !== keepId) d.open = false;
        });
      };

      const openFromHash = () => {
        const raw = (location.hash || "").slice(1);
        if (!raw) {
          openSection("resumen");
          closeAllSectionsExcept("resumen");
          return;
        }

        // Si es un día del itinerario
        if (raw.startsWith("dia-")) {
          const it = openSection("itinerario");
          closeAllSectionsExcept("itinerario");

          const dayEl = document.getElementById(raw);
          if (dayEl && dayEl.tagName.toLowerCase() === "details") {
            dayEl.open = true;
            setTimeout(() => dayEl.scrollIntoView({ behavior: "smooth", block: "start" }), 50);
          } else if (it) {
            setTimeout(() => it.scrollIntoView({ behavior: "smooth", block: "start" }), 50);
          }
          return;
        }

        // Si es una sección
        const sec = openSection(raw);
        if (sec) {
          closeAllSectionsExcept(raw);
          setTimeout(() => sec.scrollIntoView({ behavior: "smooth", block: "start" }), 50);
        }
      };

      // Click en la barra: abrir y cerrar el resto
      document.querySelectorAll(".toc a").forEach((a) => {
        a.addEventListener("click", () => {
          const id = (a.getAttribute("href") || "").replace("#", "");
          if (!id) return;
          openSection(id);
          closeAllSectionsExcept(id);
        });
      });

      window.addEventListener("hashchange", openFromHash);
      openFromHash();

      // Itinerario: solo un día abierto a la vez
      const dayDetails = Array.from(document.querySelectorAll("details.day"));
      dayDetails.forEach((d) => {
        d.addEventListener("toggle", () => {
          if (!d.open) return;
          dayDetails.forEach((other) => {
            if (other !== d) other.open = false;
          });
        });
      });

      // --- LIGHTBOX (fotos + mapa) ---
      const grid = document.getElementById("photoGrid");
      const openMapBtn = document.getElementById("openMap");

      const lightbox = document.getElementById("lightbox");
      const backdrop = document.getElementById("lbBackdrop");
      const btnClose = document.getElementById("lbClose");
      const btnPrev = document.getElementById("lbPrev");
      const btnNext = document.getElementById("lbNext");
      const imgEl = document.getElementById("lbImg");
      const counter = document.getElementById("lbCounter");

      if (!lightbox || !imgEl) return;

      const MAP_SRC = "/maps/mapmex.png";

      const imgs = grid ? Array.from(grid.querySelectorAll("img")) : [];
      let index = 0;
      let mode = "photos"; // "photos" | "map" | "hotel"
      let activeImgs = imgs;

      const showNav = () => {
        if (btnPrev) btnPrev.style.display = "";
        if (btnNext) btnNext.style.display = "";
      };

      const hideNav = () => {
        if (btnPrev) btnPrev.style.display = "none";
        if (btnNext) btnNext.style.display = "none";
      };

      const setImage = (i) => {
        if (!activeImgs.length) return;
        index = (i + activeImgs.length) % activeImgs.length;
        const src = activeImgs[index].getAttribute("src") || "";
        const alt = activeImgs[index].getAttribute("alt") || "";
        imgEl.setAttribute("src", src);
        imgEl.setAttribute("alt", alt);
        if (counter) counter.textContent = (index + 1) + " / " + activeImgs.length;
      };

      const openLightbox = () => {
        lightbox.classList.add("open");
        lightbox.setAttribute("aria-hidden", "false");
        document.documentElement.classList.add("noScroll");
      };

      const closeLightbox = () => {
        lightbox.classList.remove("open");
        lightbox.setAttribute("aria-hidden", "true");
        document.documentElement.classList.remove("noScroll");
        imgEl.removeAttribute("src");
        showNav();
        mode = "photos";
        activeImgs = imgs;
      };

      const openPhoto = (i) => {
        mode = "photos";
        activeImgs = imgs;
        showNav();
        setImage(i);
        openLightbox();
      };
      const openHotel = (i, list) => {
        mode = "hotel";
        activeImgs = list;
        showNav();
        setImage(i);
        openLightbox();
      };

      const openMap = () => {
        if (lightbox.classList.contains("open") && mode === "map") {
          closeLightbox();
          return;
        }
        mode = "map";
        hideNav();
        imgEl.setAttribute("src", MAP_SRC);
        imgEl.setAttribute("alt", "Mapa de México (ruta)");
        if (counter) counter.textContent = "Mapa";
        openLightbox();
      };

      const prev = () => setImage(index - 1);
      const next = () => setImage(index + 1);

      if (grid) {
        grid.addEventListener("click", (e) => {
          const targetImg = e.target && e.target.closest ? e.target.closest("img") : null;
          if (!targetImg) return;
          const i = imgs.indexOf(targetImg);
          if (i >= 0) openPhoto(i);
        });
      }
      const hotelImgs = Array.from(document.querySelectorAll(".hotelPhoto"));
      if (hotelImgs.length) {
        hotelImgs.forEach((img) => {
          img.addEventListener("click", () => {
            const hotelItem = img.closest(".hotelItem");
            const list = hotelItem ? Array.from(hotelItem.querySelectorAll(".hotelPhoto")) : [];
            const i = list.indexOf(img);
            if (i >= 0) openHotel(i, list);
          });
        });
      }

      if (openMapBtn) openMapBtn.addEventListener("click", openMap);

      if (btnClose) btnClose.addEventListener("click", closeLightbox);
      if (backdrop) backdrop.addEventListener("click", closeLightbox);
      if (imgEl) imgEl.addEventListener("click", () => { if (mode === "map") closeLightbox(); });

      if (btnPrev) btnPrev.addEventListener("click", () => { if (mode === "photos" || mode === "hotel") prev(); });
      if (btnNext) btnNext.addEventListener("click", () => { if (mode === "photos" || mode === "hotel") next(); });

      window.addEventListener("keydown", (e) => {
        if (!lightbox.classList.contains("open")) return;
        if (e.key === "Escape") closeLightbox();
        if (mode !== "photos" && mode !== "hotel") return;
        if (e.key === "ArrowLeft") prev();
        if (e.key === "ArrowRight") next();
      });

      let startX = 0;
      let dx = 0;

      const onTouchStart = (e) => {
        if (!lightbox.classList.contains("open")) return;
        if (mode !== "photos" && mode !== "hotel") return;
        startX = e.touches[0].clientX;
        dx = 0;
      };

      const onTouchMove = (e) => {
        if (!lightbox.classList.contains("open")) return;
        if (mode !== "photos" && mode !== "hotel") return;
        dx = e.touches[0].clientX - startX;
      };

      const onTouchEnd = () => {
        if (!lightbox.classList.contains("open")) return;
        if (mode !== "photos" && mode !== "hotel") return;
        if (Math.abs(dx) > 45) {
          if (dx > 0) prev();
          else next();
        }
        startX = 0;
        dx = 0;
      };

      lightbox.addEventListener("touchstart", onTouchStart, { passive: true });
      lightbox.addEventListener("touchmove", onTouchMove, { passive: true });
      lightbox.addEventListener("touchend", onTouchEnd, { passive: true });
    })();
  </script>
</BaseLayout>















